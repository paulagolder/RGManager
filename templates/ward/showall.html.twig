{% extends 'master.html.twig' %}

{% block stylesheets %}
      {{ parent() }}
    <link href="{{ asset('/css/ward.css') }}" rel="stylesheet" />
    <link href="{{ asset('/css/street.css') }}" rel="stylesheet" />
{% endblock %}

{% block js %}
{{ parent() }}
<script src="{{asset('js/maps.js')}}"></script>
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
<script src="{{asset('js/L.KML.js')}}"></script>
<script>
var popup = L.popup();
function onMapClick(e)
{
  popup
  .setLatLng(e.latlng)
  .setContent("You clicked the map at " + e.latlng.toString())
  .openOn(mymap);
  lat = e.latlng.lat;
  lng = e.latlng.lng;
  document.getElementById("street_form_Latitude").value=lat;
  document.getElementById("street_form_Longitude").value=lng;
}
</script>
{% endblock %}

{% block middle %}
<div class="heading  row">
  <div class="label"> All RG-Groups</div>
  <div class="button  right"> <a class="button" href = "/" >{{'back'}} </a> </div>
</div>


{% if message %}
<H1> No wards found </H1>

{% else %}
<div class="wardlist">
    <div id="wards" >
       {% for ward in wards %}
                    <div class="ward row" >
                       <div class="wardid" >{{ward.wardid}}</div>
                        <div class="name" >{{ward.ward}}</div>
                         <div class="num" >{{ward.households}}</div>
                         <div class="num" >({{ward.total}})</div>
                        <a class="button" href = "/ward/show/{{ward.wardid}}" >VIEW</a>
                     </div>
       {% endfor %}
    </div>
</div>
 <a class="button" href = "/ward/new" >ADD NEW RG-Group</a>
{% if streets|length >0 %}
<div class="subheading  row">
  <div class="label"> Spare Streets</div>
</div>
  <div class="streetlist">
       {% for street in streets %}
       <div class="street row">
                 <div class="name" >{{street.name}}</div>
                 <div class="PD" >{{street.PD}}</div>
                 <a class="button" href = "/street/edit/{{street.streetid}}" >VIEW</a>
        </div>
       {% endfor %}
   </div>
   {% else %}
   <div class="subheading  row">
  <div class="label"> No un-allocated streets found</div>
</div>
   {% endif %}
   {% if roadgroups|length >0 %}
<div class="subheading  row">
  <div class="label">Spare Roadgroups</div>
</div>
  <div class="list">
       {% for roadgroup in roadgroups %}
       <div class=" row">
                 <div class="rgid" >{{roadgroup.roadgroupid}}</div>
                 <div class="name" >{{roadgroup.name}}</div>
                 <a class="button" href = "/roadgroup/edit/{{roadgroup.roadgroupid}}" >VIEW</a>
        </div>
       {% endfor %}
   </div>
   {% else %}
   <div class="subheading  row">
  <div class="label"> No un-allocated roadgroups found</div>
</div>
   {% endif %}
{% endif %}
</div>
<div class="map" >
  <div id="wmapid" ></div>
</div>

<script >
var jslocation = '{ "name":"LCC","longitude":"-1.8304","latitude":"52.6854" }';

var mymap = myWMap(jslocation);
var i=0;
var bounds = null;
var wardlayer = null;
var fgroup =  new L.featureGroup();
var path = "{{mappath}}LCC.kml";
if(CheckUrl(path))
{
  var style = {"color":  "#0000FF" , "weight": 5 ,  "clickable": true ,"opacity": 0.2, "fillOpacity": 0.2 };
  wardlayer = makeKMLLayer(mymap, path,style);
}


//mymap.fitBounds(wardlayer.getBounds());
mymap.on('click', onMapClick);
</script>
{% endblock %}
