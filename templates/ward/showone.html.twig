{# views/ward/showone.html.twig #}

{% extends 'master.html.twig' %}

{% block stylesheets %}
  {{ parent() }}
  <link href="{{ asset('/css/ward.css') }}" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"/>
{% endblock %}

{% block js %}
  {{ parent() }}
  <script src="{{asset('js/maps.js')}}"></script>
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
  <script src="{{asset('js/L.KML.js')}}"></script>
  <script>
    var popup = L.popup();
    function onMapClick(e)
    {
    popup
    .setLatLng(e.latlng)
    .setContent("You clicked the map at " + e.latlng.toString())
    .openOn(mymap);
    lat = e.latlng.lat;
    lng = e.latlng.lng;
    document.getElementById("street_form_Latitude").value=lat;
     document.getElementById("street_form_Longitude").value=lng;
    }
  </script>
{% endblock %}


{% block middle %}


{% if message %}
   <H1> {{message}} </H1>
{% else %}
      <div class="heading  row">
        <div class="label"> RG-Groups:</div>
        <div class="value"> {{ward.wardid}}:</div>
        <div class="value"> {{ward.ward}}</div>
        <div class="value"> {{ward.households}}</div>
        <div class="button  right"> <a class="button" href = "{{back}}" >{{'back'}} </a> </div>
      </div>
      <div class="wards">
      {% for subward in subwards %}
         <div class="ward row" >
           <div class="subwardid" id="{{subward.subwardid}}">{{subward.subwardid}}</div>
           <div class="name" >{{subward.subward}}</div>
           <div class="num" >{{subward.total}}</div>
           <a class="button" href = "/subward/show/{{subward.subwardid}}" >VIEW</a>
           <a class="button" href = "/subward/edit/{{subward.subwardid}}" >EDIT</a>
        </div>
      {% endfor %}
      </div>
      <a class="button" href = "/subward/new/{{ward.wardid}}" >MAKE RG-Subgroup</a>
      {% if streets|length >0 %}
         <div class="subheading  row">
           <div class="label red"> Spare Streets</div>
         </div>
         <div class="streetlist">
  {% for street in streets %}
  <div class="street row  indent">
    <div class="name" >{{street.name}}</div>
    <div class="PD" >{{street.PD}}</div>
    <a class="button" href = "/street/edit/{{street.streetid}}" >VIEW</a>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="subheading  row">
  <div class="label"> No un-allocated streets found</div>
</div>
{% endif %}
{% if roadgroups|length >0 %}
<div class="subheading  row">
  <div class="label red"> Roadgroups unallocated</div>
</div>
<div class="list">
  {% for roadgroup in roadgroups %}
  <div class=" row  indent">
    <div class="rgid" >{{roadgroup.roadgroupid}}</div>
    <div class="name" >{{roadgroup.name}}</div>
    <a class="button" href = "/roadgroup/edit/{{roadgroup.roadgroupid}}" >VIEW</a>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="subheading  row">
  <div class="label"> No un-allocated roadgroups found</div>
</div>
{% endif %}

<div class="map" >
  <div id="wmapid" ></div>
</div>
{% set jslocation = ward.getjson() %}

<script >

var mymap = myWMap("{{jslocation}}");
var i=0;
var bounds = null;
var wardlayer = null;
var fgroup =  new L.featureGroup();
var path = "{{mappath}}{{ward.wardid}}.kml";
if(CheckUrl(path))
{
    var style = {"color": "#0000FF","fillcolor": "#FF00FF", "weight": 5 ,  "clickable": true,"opacity": 0.2, "fillOpacity": 0.2 };
    makeKMLLayer(mymap, path,style);
}

var jsrglist = {{roadgrouplist|json_encode|raw}};
for ( var swdid in jsrglist)
{
  var countsgs = 0;
  var rgtracks = jsrglist[swdid];
  if( rgtracks.length > 0)
  {
    var style = {"color":  getColor(i) , "weight": 4 ,  "clickable": true ,"opacity": 1.0, "fillOpacity": 1.0 };
    for( var rgid in rgtracks)
    {
      rg =rgtracks[rgid];
      var path = "{{mappath}}"+rg+".kml";
      if(CheckUrl(path))
      {
        countsgs = countsgs+1;
        makeKMLLayer(mymap,path,style);
      }
    }
  }
  if(countsgs > 0)
  {
    var h2s = document.getElementById(swdid);
    h2s.style.backgroundColor = getColor(i);
    i=i+1;
  }
}

var path = "{{mappath}}{{ward.wardid}}.kml";
if(CheckUrl(path))
{
  var style = {"color":  "#0000FF" , "weight": 5 ,  "clickable": true ,"opacity": 0.7, "fillOpacity": 0.0 };
  wardlayer = makeKMLLayer(mymap, path,style);
}
//mymap.fitBounds(wardlayer.getBounds());
mymap.on('click', onMapClick);
</script>
{% endif %}
{% endblock %}
